<div class="dev-container">
  <div class="dev-header">
    <button class="back-btn" (click)="goBack()">&larr;</button>
    <h1 class="dev-title">Developer Dashboard</h1>
    <button class="refresh-btn" (click)="loadStatus()" [disabled]="loading">Refresh</button>
  </div>

  <div *ngIf="loading && !status" class="dev-loading">Loading system status...</div>
  <div *ngIf="error" class="dev-error">{{ error }}</div>

  <div *ngIf="status" class="dev-grid">

    <!-- Server Info -->
    <div class="dev-card">
      <h3 class="card-title">Server</h3>
      <div class="stat-row">
        <span class="stat-label">Uptime</span>
        <span class="stat-value">{{ status.server.uptimeFormatted }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Memory</span>
        <span class="stat-value">{{ status.server.memoryUsage }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Node</span>
        <span class="stat-value">{{ status.server.nodeVersion }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Environment</span>
        <span class="stat-value env-badge">{{ status.server.environment }}</span>
      </div>
    </div>

    <!-- API Status -->
    <div class="dev-card">
      <h3 class="card-title">APIs</h3>
      <div class="stat-row" *ngFor="let api of ['finnhub', 'database', 'websocket']">
        <span class="stat-label">{{ api | titlecase }}</span>
        <span class="stat-value api-badge" [ngClass]="getApiClass(status.apis[api])">{{ status.apis[api] }}</span>
      </div>
    </div>

    <!-- Database Stats -->
    <div class="dev-card">
      <h3 class="card-title">Database</h3>
      <div class="stat-row">
        <span class="stat-label">Users</span>
        <span class="stat-value">{{ status.database.users }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Trades</span>
        <span class="stat-value">{{ status.database.trades }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Earnings</span>
        <span class="stat-value">{{ status.database.earnings }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">AI Picks Today</span>
        <span class="stat-value">{{ status.database.aiPicksToday }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Option Trades</span>
        <span class="stat-value">{{ status.database.optionTrades }}</span>
      </div>
    </div>

    <!-- Scheduler Jobs -->
    <div class="dev-card wide-card">
      <h3 class="card-title">Scheduled Jobs</h3>
      <table class="jobs-table">
        <thead>
          <tr>
            <th>Job</th>
            <th>Schedule</th>
            <th>Status</th>
            <th>Last Run</th>
            <th>Duration</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let jobKey of ['dailyRefresh', 'monthlyEarnings', 'aiDailyPicks', 'marketHoursUpdates']">
            <td class="job-name">{{ status.scheduler.jobs[jobKey].description }}</td>
            <td class="job-cron"><code>{{ status.scheduler.jobs[jobKey].cron }}</code></td>
            <td>
              <span class="scheduled-badge" [class.active]="status.scheduler.jobs[jobKey].scheduled">
                {{ status.scheduler.jobs[jobKey].scheduled ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <span [ngClass]="getStatusClass(status.scheduler.jobs[jobKey].lastStatus)">
                {{ formatTime(status.scheduler.jobs[jobKey].lastRun) }}
              </span>
            </td>
            <td>{{ formatDuration(status.scheduler.jobs[jobKey].lastDuration) }}</td>
            <td>
              <button *ngIf="jobKey === 'aiDailyPicks'" class="trigger-btn" (click)="triggerJob('ai-picks')">Run</button>
              <button *ngIf="jobKey === 'monthlyEarnings'" class="trigger-btn" (click)="triggerJob('earnings')">Run</button>
              <button *ngIf="jobKey === 'dailyRefresh'" class="trigger-btn" (click)="triggerJob('stocks')">Run</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="triggerMessage" class="trigger-message" [class.error]="triggerIsError">{{ triggerMessage }}</div>
    </div>

    <!-- Recent Logs -->
    <div class="dev-card wide-card">
      <h3 class="card-title">Scheduler Logs</h3>
      <div class="logs-container" *ngIf="status.scheduler.logs?.length > 0">
        <div *ngFor="let log of status.scheduler.logs" class="log-entry" [ngClass]="'log-' + log.level">
          <span class="log-time">{{ formatTime(log.time) }}</span>
          <span class="log-level">{{ log.level }}</span>
          <span class="log-msg">{{ log.message }}</span>
        </div>
      </div>
      <div *ngIf="!status.scheduler.logs?.length" class="no-logs">No logs yet. Logs appear after scheduled jobs run.</div>
    </div>

  </div>
</div>
