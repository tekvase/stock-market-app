<div class="dashboard-container">
  <!-- Search Bar (visible only on watchlist tab) -->
  <div class="search-section" *ngIf="activeTab === 'watchlist'">
    <form (submit)="onSearchSubmit($event)" class="search-form">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        name="searchTerm"
        (input)="onSearchChange($event)"
        placeholder="Search for symbol (e.g. AAPL) and press Enter"
        class="search-input"
        aria-label="Search for stock symbol"
      />
      <button type="submit" class="search-button" [disabled]="searchingSymbol || !searchTerm.trim()">
        {{ searchingSymbol ? 'Searching...' : 'Search' }}
      </button>
    </form>
  </div>

  <div *ngIf="searchError" class="error-message" role="alert">{{ searchError }}</div>

  <!-- Search Result Popup -->
  <div *ngIf="showSearchPopup" class="popup-overlay" (click)="closeSearchPopup()" role="dialog" aria-modal="true" aria-label="Stock search result">
    <div class="popup-content" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>Stock Found</h3>
        <button class="close-btn" (click)="closeSearchPopup()" aria-label="Close dialog">&times;</button>
      </div>
      <div class="popup-body" *ngIf="searchResult">
        <div class="stock-info">
          <div class="stock-symbol">{{ searchResult.symbol }}</div>
          <div class="stock-name">{{ searchResult.name }}</div>
          <span class="sector-badge" *ngIf="showDetails && searchDetails?.sector">{{ searchDetails.sector }}</span>
          <div class="stock-price">${{ searchResult.price | number:'1.2-2' }}</div>
          <div class="stock-change" [class.positive]="searchResult.change >= 0" [class.negative]="searchResult.change < 0">
            {{ searchResult.change >= 0 ? '+' : '' }}{{ searchResult.change | number:'1.2-2' }} ({{ searchResult.changePercent | number:'1.2-2' }}%)
          </div>
        </div>

        <!-- Company Details (access code 10 or 3 only) -->
        <div *ngIf="showDetails && loadingDetails" class="details-loading">Loading details...</div>
        <div *ngIf="showDetails && !loadingDetails && searchDetails" class="stock-details">
          <p class="company-description" *ngIf="searchDetails.description">{{ searchDetails.description }}</p>

          <div class="details-grid">
            <div class="detail-item" *ngIf="searchDetails.marketCap">
              <span class="detail-label">Market Cap</span>
              <span class="detail-value">{{ formatRevenue(searchDetails.marketCap * 1000000) }}</span>
            </div>
            <div class="detail-item" *ngIf="searchDetails.country">
              <span class="detail-label">Country</span>
              <span class="detail-value">{{ searchDetails.country }}</span>
            </div>
            <div class="detail-item" *ngIf="searchDetails.nextEarnings">
              <span class="detail-label">Next Earnings</span>
              <span class="detail-value">{{ searchDetails.nextEarnings | date:'MMM d, yyyy' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">EPS (TTM)</span>
              <span class="detail-value metric-hover" *ngIf="searchDetails.epsTTM !== null && searchDetails.epsTTM !== undefined">
                {{ searchDetails.epsTTM | number:'1.2-2' }}
                <span class="custom-tooltip" *ngIf="getMetricTooltip('EPS', searchDetails.epsTTM)">{{ getMetricTooltip('EPS', searchDetails.epsTTM) }}</span>
              </span>
              <span class="detail-value" *ngIf="searchDetails.epsTTM === null || searchDetails.epsTTM === undefined">N/A</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">P/E Ratio</span>
              <span class="detail-value metric-hover" *ngIf="searchDetails.peRatio !== null && searchDetails.peRatio !== undefined">
                {{ searchDetails.peRatio | number:'1.2-2' }}
                <span class="custom-tooltip" *ngIf="getMetricTooltip('PE', searchDetails.peRatio)">{{ getMetricTooltip('PE', searchDetails.peRatio) }}</span>
              </span>
              <span class="detail-value" *ngIf="searchDetails.peRatio === null || searchDetails.peRatio === undefined">N/A</span>
            </div>
            <div class="detail-item" *ngIf="searchDetails.week52High">
              <span class="detail-label">52W High</span>
              <span class="detail-value">${{ searchDetails.week52High | number:'1.2-2' }}</span>
            </div>
            <div class="detail-item" *ngIf="searchDetails.week52Low">
              <span class="detail-label">52W Low</span>
              <span class="detail-value">${{ searchDetails.week52Low | number:'1.2-2' }}</span>
            </div>
            <div class="detail-item" *ngIf="searchDetails.ipo">
              <span class="detail-label">IPO Date</span>
              <span class="detail-value">{{ searchDetails.ipo }}</span>
            </div>
          </div>

          <!-- Analyst Recommendations -->
          <div *ngIf="searchDetails.recommendation" class="analyst-section">
            <div class="analyst-title">Analyst Ratings</div>
            <div class="analyst-bar">
              <div class="bar-strong-buy" [style.width.%]="(searchDetails.recommendation.strongBuy / getRecommendationTotal(searchDetails.recommendation)) * 100" title="Strong Buy: {{ searchDetails.recommendation.strongBuy }}"></div>
              <div class="bar-buy" [style.width.%]="(searchDetails.recommendation.buy / getRecommendationTotal(searchDetails.recommendation)) * 100" title="Buy: {{ searchDetails.recommendation.buy }}"></div>
              <div class="bar-hold" [style.width.%]="(searchDetails.recommendation.hold / getRecommendationTotal(searchDetails.recommendation)) * 100" title="Hold: {{ searchDetails.recommendation.hold }}"></div>
              <div class="bar-sell" [style.width.%]="(searchDetails.recommendation.sell / getRecommendationTotal(searchDetails.recommendation)) * 100" title="Sell: {{ searchDetails.recommendation.sell }}"></div>
              <div class="bar-strong-sell" [style.width.%]="(searchDetails.recommendation.strongSell / getRecommendationTotal(searchDetails.recommendation)) * 100" title="Strong Sell: {{ searchDetails.recommendation.strongSell }}"></div>
            </div>
            <div class="analyst-labels">
              <span class="label-strong-buy">Strong Buy {{ searchDetails.recommendation.strongBuy }}</span>
              <span class="label-buy">Buy {{ searchDetails.recommendation.buy }}</span>
              <span class="label-hold">Hold {{ searchDetails.recommendation.hold }}</span>
              <span class="label-sell">Sell {{ searchDetails.recommendation.sell }}</span>
              <span class="label-strong-sell">Strong Sell {{ searchDetails.recommendation.strongSell }}</span>
            </div>
          </div>
        </div>

        <div class="popup-actions">
          <button class="add-btn" (click)="addStockFromPopup()">ADD TO WATCHLIST</button>
          <button class="cancel-btn" (click)="closeSearchPopup()">CANCEL</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-nav" role="tablist" aria-label="Dashboard sections">
    <button
      *ngFor="let tab of tabs; let i = index"
      [id]="'tab-' + tab.id"
      role="tab"
      [attr.aria-selected]="activeTab === tab.id"
      [attr.aria-controls]="'panel-' + tab.id"
      [attr.tabindex]="activeTab === tab.id ? 0 : -1"
      [class.tab-active]="activeTab === tab.id"
      class="tab-button"
      (click)="selectTab(tab.id)"
      (keydown)="onTabKeydown($event, i)"
    >
      {{ tab.label }}
    </button>
  </div>

  <!-- Tab Panels -->

  <!-- Stock Watch List Panel -->
  <div
    id="panel-watchlist"
    role="tabpanel"
    aria-labelledby="tab-watchlist"
    [attr.tabindex]="0"
    *ngIf="activeTab === 'watchlist'"
    class="section tab-panel"
  >
    <div *ngIf="loading" class="loading" role="status" aria-live="polite">Loading stocks...</div>

    <div *ngIf="!loading">
      <!-- Portfolio Summary Bar -->
      <div class="portfolio-summary" *ngIf="stocks.length > 0">
        <div class="summary-item">
          <span class="summary-label">Total Stocks</span>
          <span class="summary-value">{{ getPortfolioSummary().total }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <span class="summary-label">In Profit</span>
          <span class="summary-value summary-profit">{{ getPortfolioSummary().inProfit }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <span class="summary-label">In Loss</span>
          <span class="summary-value summary-loss">{{ getPortfolioSummary().inLoss }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <span class="summary-label">Avg Return</span>
          <span class="summary-value" [class.summary-profit]="getPortfolioSummary().avgReturn >= 0" [class.summary-loss]="getPortfolioSummary().avgReturn < 0">
            {{ getPortfolioSummary().avgReturn >= 0 ? '+' : '' }}{{ getPortfolioSummary().avgReturn | number:'1.2-2' }}%
          </span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <span class="summary-label">Total P&amp;L</span>
          <span class="summary-value" [class.summary-profit]="getPortfolioSummary().totalProfit >= 0" [class.summary-loss]="getPortfolioSummary().totalProfit < 0">
            {{ getPortfolioSummary().totalProfit >= 0 ? '+$' : '-$' }}{{ (getPortfolioSummary().totalProfit >= 0 ? getPortfolioSummary().totalProfit : -getPortfolioSummary().totalProfit) | number:'1.2-2' }}
          </span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <span class="summary-label">Monthly P&amp;L</span>
          <span class="summary-value" *ngIf="!loadingMonthlyPL" [class.summary-profit]="monthlyPL >= 0" [class.summary-loss]="monthlyPL < 0">
            {{ monthlyPL >= 0 ? '+$' : '-$' }}{{ (monthlyPL >= 0 ? monthlyPL : -monthlyPL) | number:'1.2-2' }}
          </span>
          <span class="summary-value" *ngIf="loadingMonthlyPL">...</span>
        </div>
      </div>

      <div class="table-container">
        <table class="stock-table" aria-label="Stock watch list">
          <thead>
            <tr>
              <th scope="col" class="sortable-th" (click)="toggleSort('symbol')">Symbol <span class="sort-icon">{{ getSortIcon('symbol') }}</span></th>
              <th scope="col" class="sortable-th" (click)="toggleSort('price')">Current Price <span class="sort-icon">{{ getSortIcon('price') }}</span></th>
              <th scope="col" class="sortable-th" (click)="toggleSort('buyPrice')">Buy Price <span class="sort-icon">{{ getSortIcon('buyPrice') }}</span></th>
              <th scope="col" class="sortable-th" (click)="toggleSort('shares')">Shares <span class="sort-icon">{{ getSortIcon('shares') }}</span></th>
              <th scope="col" class="sortable-th" (click)="toggleSort('weight')">Diversity <span class="sort-icon">{{ getSortIcon('weight') }}</span></th>
              <th scope="col" class="sortable-th" (click)="toggleSort('pl')">P&amp;L <span class="sort-icon">{{ getSortIcon('pl') }}</span></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let stock of getFilteredStocks(); let i = index" (dblclick)="navigateToStock(stock.symbol)" style="cursor: pointer;" title="Double-click to view details">
              <td>
                <a *ngIf="canViewStockPage" [routerLink]="['/stock', stock.symbol]" class="symbol-link">
                  {{ stock.symbol }}
                </a>
                <span *ngIf="!canViewStockPage">{{ stock.symbol }}</span>
                <div class="stock-name-small">{{ stock.name }}</div>
              </td>
              <td [class.positive]="stock.change >= 0" [class.negative]="stock.change < 0">
                {{ stock.price | number:'1.2-2' }}
              </td>
              <td class="buy-price-cell">
                <span *ngIf="editingSymbol !== stock.symbol" class="buy-price-display" (click)="startEditBuyPrice(stock)" title="Click to edit">
                  {{ stock.buyPrice | number:'1.2-2' }}
                </span>
                <div *ngIf="editingSymbol === stock.symbol" class="buy-price-edit">
                  <input
                    type="number"
                    [(ngModel)]="editBuyPrice"
                    (keydown)="onEditKeydown($event, stock)"
                    (blur)="saveBuyPrice(stock)"
                    class="edit-input"
                    step="0.01"
                    min="0.01"
                    autofocus
                  />
                </div>
              </td>
              <td class="shares-cell">
                <input
                  type="number"
                  class="shares-input"
                  [value]="stock.shares || ''"
                  (input)="onSharesChange(stock, $event)"
                  placeholder="—"
                  step="1"
                  min="0"
                />
              </td>
              <td class="weight-cell">
                <span *ngIf="getStockWeight(stock) > 0" class="weight-value" [class.weight-danger]="getStockWeight(stock) > 50">
                  {{ getStockWeight(stock) | number:'1.1-1' }}%
                </span>
                <span *ngIf="getStockWeight(stock) === 0" class="pl-empty">—</span>
              </td>
              <td>
                <div *ngIf="stock.buyPrice > 0" class="pl-display">
                  <span class="pl-amount" [class.positive]="stock.price >= stock.buyPrice" [class.negative]="stock.price < stock.buyPrice">
                    {{ stock.price >= stock.buyPrice ? '+$' : '-$' }}{{ (getCurrentPL(stock) >= 0 ? getCurrentPL(stock) : -getCurrentPL(stock)) | number:'1.2-2' }}
                    ({{ stock.price >= stock.buyPrice ? '+' : '' }}{{ getCurrentPLPercent(stock) | number:'1.2-2' }}%)
                  </span>
                </div>
                <span *ngIf="!stock.buyPrice || stock.buyPrice <= 0" class="pl-empty">—</span>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="getFilteredStocks().length === 0" class="no-data">
          No stocks in your list. Search for a symbol above to add.
        </div>
      </div>

      <!-- Mobile Card View -->
      <div class="mobile-stock-cards">
        <div *ngFor="let stock of getFilteredStocks()" class="stock-card" (click)="navigateToStock(stock.symbol)">
          <div class="card-top">
            <div class="card-symbol-section">
              <a *ngIf="canViewStockPage" [routerLink]="['/stock', stock.symbol]" class="card-symbol">{{ stock.symbol }}</a>
              <span *ngIf="!canViewStockPage" class="card-symbol">{{ stock.symbol }}</span>
              <span class="card-name">{{ stock.name }}</span>
            </div>
            <div class="card-price-section">
              <span class="card-current-price" [class.positive]="stock.price >= stock.buyPrice" [class.negative]="stock.price < stock.buyPrice">
                ${{ stock.price | number:'1.2-2' }}
              </span>
            </div>
          </div>
          <div class="card-details">
            <div class="card-detail">
              <span class="card-label">Buy</span>
              <span *ngIf="editingSymbol !== stock.symbol" class="card-val card-buy-editable" (click)="startEditBuyPrice(stock); $event.stopPropagation()">${{ stock.buyPrice | number:'1.2-2' }}</span>
              <div *ngIf="editingSymbol === stock.symbol" class="card-buy-edit" (click)="$event.stopPropagation()">
                <input
                  type="number"
                  [(ngModel)]="editBuyPrice"
                  (keydown)="onEditKeydown($event, stock)"
                  (blur)="saveBuyPrice(stock)"
                  class="card-edit-input"
                  step="0.01"
                  min="0.01"
                >
              </div>
            </div>
            <div class="card-detail">
              <span class="card-label">Shares</span>
              <span class="card-val">{{ stock.shares || '—' }}</span>
            </div>
            <div class="card-detail">
              <span class="card-label">Diversity</span>
              <span class="card-val" [class.weight-danger]="getStockWeight(stock) > 50">
                {{ getStockWeight(stock) > 0 ? (getStockWeight(stock) | number:'1.1-1') + '%' : '—' }}
              </span>
            </div>
            <div class="card-detail card-pl-detail">
              <span class="card-label">P&amp;L</span>
              <span *ngIf="stock.buyPrice > 0" class="card-val" [class.positive]="stock.price >= stock.buyPrice" [class.negative]="stock.price < stock.buyPrice">
                {{ stock.price >= stock.buyPrice ? '+$' : '-$' }}{{ (getCurrentPL(stock) >= 0 ? getCurrentPL(stock) : -getCurrentPL(stock)) | number:'1.2-2' }}
                ({{ stock.price >= stock.buyPrice ? '+' : '' }}{{ getCurrentPLPercent(stock) | number:'1.2-2' }}%)
              </span>
              <span *ngIf="!stock.buyPrice || stock.buyPrice <= 0" class="card-val">—</span>
            </div>
          </div>
        </div>
        <div *ngIf="getFilteredStocks().length === 0" class="no-data">
          No stocks in your list. Search for a symbol above to add.
        </div>
      </div>


    </div>
  </div>

  <!-- Options Panel -->
  <div
    id="panel-options"
    role="tabpanel"
    aria-labelledby="tab-options"
    [attr.tabindex]="0"
    *ngIf="activeTab === 'options'"
    class="section tab-panel"
  >
    <!-- Options Header with Add Button -->
    <div class="options-header">
      <div class="options-summary" *ngIf="userOptions.length > 0">
        <div class="summary-item">
          <span class="summary-label">Positions</span>
          <span class="summary-value">{{ getOptionsSummary().count }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item">
          <span class="summary-label">Total Invested</span>
          <span class="summary-value">${{ getOptionsSummary().totalInvested | number:'1.2-2' }}</span>
        </div>
      </div>
      <button class="add-option-btn" (click)="openAddOptionForm()">+ Add Option</button>
    </div>

    <div *ngIf="loadingOptions" class="loading">Loading options...</div>

    <div *ngIf="!loadingOptions && userOptions.length > 0" class="table-container">
      <table class="stock-table options-table" aria-label="Options trading table">
        <thead>
          <tr>
            <th scope="col">No</th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('symbol')">Symbol <span class="sort-icon">{{ getOptionsSortIcon('symbol') }}</span></th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('side')">Side <span class="sort-icon">{{ getOptionsSortIcon('side') }}</span></th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('type')">Type <span class="sort-icon">{{ getOptionsSortIcon('type') }}</span></th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('strike')">Strike <span class="sort-icon">{{ getOptionsSortIcon('strike') }}</span></th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('expiry')">Expiry <span class="sort-icon">{{ getOptionsSortIcon('expiry') }}</span></th>
            <th scope="col">DTE</th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('premium')">Premium <span class="sort-icon">{{ getOptionsSortIcon('premium') }}</span></th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('contracts')">Contracts <span class="sort-icon">{{ getOptionsSortIcon('contracts') }}</span></th>
            <th scope="col" class="sortable-th" (click)="toggleOptionsSort('cost')">{{ 'Total' }} <span class="sort-icon">{{ getOptionsSortIcon('cost') }}</span></th>
            <th scope="col"><span class="sr-only">Actions</span></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let opt of getSortedOptions(); let i = index">
            <td>{{ i + 1 }}</td>
            <td>
              <span class="option-symbol">{{ opt.symbol }}</span>
            </td>
            <td>
              <span class="side-badge" [class.side-buy]="opt.side === 'Buy'" [class.side-sell]="opt.side === 'Sell'">
                {{ opt.side }}
              </span>
            </td>
            <td>
              <span class="option-type-badge" [class.option-call]="opt.type === 'Call'" [class.option-put]="opt.type === 'Put'">
                {{ opt.type }}
              </span>
            </td>
            <td>${{ opt.strike | number:'1.2-2' }}</td>
            <td>{{ opt.expiry | date:'MMM d, yyyy' }}</td>
            <td>
              <span class="dte-badge" [ngClass]="getExpiryClass(opt.expiry)">
                {{ getExpiryStatus(opt.expiry) }}
              </span>
            </td>
            <td>${{ opt.premium | number:'1.4-4' }}</td>
            <td>{{ opt.contracts }}</td>
            <td>
              <span [class.positive]="opt.side === 'Sell'" [class.negative]="opt.side === 'Buy'">
                {{ opt.side === 'Sell' ? '+' : '-' }}${{ getOptionTotalCost(opt) | number:'1.2-2' }}
              </span>
            </td>
            <td>
              <button class="delete-button" (click)="confirmDeleteOption(opt.id)" [attr.aria-label]="'Remove ' + opt.symbol + ' option'">&times;</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loadingOptions && userOptions.length === 0" class="no-data">
      No option trades yet. Click "+ Add Option" to get started.
    </div>

    <!-- Add Option Popup -->
    <div *ngIf="showAddOptionForm" class="popup-overlay" (click)="closeAddOptionForm()">
      <div class="popup-content option-popup" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h3>Add Option Trade</h3>
          <button class="close-btn" (click)="closeAddOptionForm()">&times;</button>
        </div>
        <div class="popup-body">
          <!-- Search for options chain -->
          <div class="option-search-row">
            <input
              type="text"
              [(ngModel)]="optionSearchTerm"
              placeholder="Enter symbol (e.g. AAPL)"
              class="search-input"
              (keydown.enter)="searchOptionChain()"
            />
            <button class="search-button" (click)="searchOptionChain()" [disabled]="optionSearching || !optionSearchTerm.trim()">
              {{ optionSearching ? 'Loading...' : 'Load Chain' }}
            </button>
          </div>

          <div *ngIf="optionSearchError" class="error-message">{{ optionSearchError }}</div>

          <!-- Expiry selector -->
          <div *ngIf="optionChainExpiries.length > 0" class="expiry-selector">
            <label>Expiry Date:</label>
            <select [(ngModel)]="selectedExpiry" (change)="onExpiryChange()">
              <option *ngFor="let exp of optionChainExpiries" [value]="exp">{{ exp | date:'MMM d, yyyy' }}</option>
            </select>
          </div>

          <!-- Options chain list -->
          <div *ngIf="optionChainOptions.length > 0" class="chain-list">
            <div class="chain-scroll">
              <table class="chain-table">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Strike</th>
                    <th>Last</th>
                    <th>Bid</th>
                    <th>Ask</th>
                    <th>Vol</th>
                    <th>OI</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let chain of optionChainOptions" [class.itm-row]="chain.inTheMoney">
                    <td>
                      <span class="option-type-badge" [class.option-call]="chain.type === 'Call'" [class.option-put]="chain.type === 'Put'">
                        {{ chain.type }}
                      </span>
                    </td>
                    <td class="chain-strike">${{ chain.strike | number:'1.2-2' }}</td>
                    <td>{{ chain.lastPrice | number:'1.2-2' }}</td>
                    <td>{{ chain.bid | number:'1.2-2' }}</td>
                    <td>{{ chain.ask | number:'1.2-2' }}</td>
                    <td>{{ chain.volume || 0 }}</td>
                    <td>{{ chain.openInterest || 0 }}</td>
                    <td>
                      <button class="chain-select-btn" (click)="selectOptionFromChain(chain)">Select</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Manual entry / selected option form -->
          <div class="option-form" *ngIf="newOption.symbol">
            <h4>Trade Details</h4>
            <!-- Buy/Sell Toggle -->
            <div class="side-toggle">
              <button class="side-btn" [class.side-btn-active]="newOption.side === 'Buy'" [class.side-buy-active]="newOption.side === 'Buy'" (click)="newOption.side = 'Buy'">Buy</button>
              <button class="side-btn" [class.side-btn-active]="newOption.side === 'Sell'" [class.side-sell-active]="newOption.side === 'Sell'" (click)="newOption.side = 'Sell'">Sell</button>
            </div>
            <div class="form-grid">
              <div class="form-field">
                <label>Symbol</label>
                <input type="text" [(ngModel)]="newOption.symbol" class="form-input" />
              </div>
              <div class="form-field">
                <label>Type</label>
                <select [(ngModel)]="newOption.optionType" class="form-input">
                  <option value="Call">Call</option>
                  <option value="Put">Put</option>
                </select>
              </div>
              <div class="form-field">
                <label>Strike</label>
                <input type="number" [(ngModel)]="newOption.strike" class="form-input" step="0.5" />
              </div>
              <div class="form-field">
                <label>Expiry</label>
                <input type="date" [(ngModel)]="newOption.expiry" class="form-input" />
              </div>
              <div class="form-field">
                <label>{{ newOption.side === 'Sell' ? 'Premium Received' : 'Premium Paid' }}</label>
                <input type="number" [(ngModel)]="newOption.premiumPaid" class="form-input" step="0.01" />
              </div>
              <div class="form-field">
                <label>Contracts</label>
                <input type="number" [(ngModel)]="newOption.contracts" class="form-input" min="1" step="1" />
              </div>
            </div>
            <div class="option-form-cost" *ngIf="newOption.premiumPaid > 0 && newOption.contracts > 0" [class.option-form-credit]="newOption.side === 'Sell'">
              {{ newOption.side === 'Sell' ? 'Total Credit' : 'Total Cost' }}: <strong>${{ (newOption.premiumPaid * newOption.contracts * 100) | number:'1.2-2' }}</strong>
            </div>
          </div>

          <!-- Or manual entry trigger -->
          <div *ngIf="!newOption.symbol && !optionChainData" class="manual-entry-hint">
            <p>Search a symbol to load the options chain, or</p>
            <button class="manual-entry-btn" (click)="newOption.symbol = optionSearchTerm.trim().toUpperCase() || 'AAPL'">Enter Manually</button>
          </div>

          <div class="popup-actions" *ngIf="newOption.symbol">
            <button class="add-btn" (click)="submitAddOption()" [disabled]="addingOption || !newOption.strike || !newOption.expiry || !newOption.premiumPaid">
              {{ addingOption ? 'Adding...' : 'ADD OPTION TRADE' }}
            </button>
            <button class="cancel-btn" (click)="closeAddOptionForm()">CANCEL</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Option Confirmation -->
    <div class="confirm-overlay" *ngIf="deleteOptionConfirmId" (click)="cancelDeleteOption()">
      <div class="confirm-dialog" (click)="$event.stopPropagation()">
        <h3>Remove Option Trade</h3>
        <p>Are you sure you want to remove this option trade?</p>
        <div class="confirm-actions">
          <button class="confirm-cancel" (click)="cancelDeleteOption()">Cancel</button>
          <button class="confirm-delete" (click)="deleteOption(deleteOptionConfirmId!)">Remove</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Daily Picks Panel -->
  <div
    id="panel-recommendations"
    role="tabpanel"
    aria-labelledby="tab-recommendations"
    [attr.tabindex]="0"
    *ngIf="activeTab === 'recommendations'"
    class="section tab-panel"
  >
    <div class="picks-header">
      <h2 class="panel-title">AI Daily Picks</h2>
      <span class="picks-date" *ngIf="picksDate">{{ picksDate }}</span>
      <span class="picks-count" *ngIf="picksTotalCount > 0">{{ picksTotalCount }} stocks</span>
    </div>

    <!-- Price Filter Chips -->
    <div class="picks-filters">
      <div class="filter-row">
        <button
          *ngFor="let filter of priceFilters"
          class="filter-chip"
          [class.filter-chip-active]="activePriceFilter === filter.id"
          (click)="setPriceFilter(filter.id)">
          {{ filter.label }}
        </button>
      </div>
    </div>

    <!-- Category Filter Chips -->
    <div class="category-filters" *ngIf="picksCategories.length > 0">
      <button
        *ngFor="let cat of picksCategories"
        class="category-chip"
        [class.category-chip-active]="activeCategoryFilter === cat"
        (click)="setCategoryFilter(cat)">
        {{ cat }}
      </button>
    </div>

    <div *ngIf="loadingPicks && dailyPicks.length === 0" class="loading">Loading AI picks...</div>

    <div *ngIf="!loadingPicks && dailyPicks.length === 0" class="no-data">
      No picks available for this filter. Try a different price range or category.
    </div>

    <div *ngIf="dailyPicks.length > 0" class="picks-grid">
      <div *ngFor="let pick of dailyPicks; let i = index" class="picks-card">
        <div class="picks-card-top">
          <div class="picks-rank">#{{ i + 1 + picksOffset }}</div>
          <div class="picks-info">
            <span class="picks-symbol">{{ pick.symbol }}</span>
            <span class="picks-name">{{ pick.name }}</span>
          </div>
          <div class="picks-price-section">
            <span class="picks-price">${{ pick.price | number:'1.2-2' }}</span>
            <span class="picks-change" [class.positive]="pick.change >= 0" [class.negative]="pick.change < 0">
              {{ pick.change >= 0 ? '+' : '' }}{{ pick.change | number:'1.2-2' }}
              ({{ pick.change_percent >= 0 ? '+' : '' }}{{ pick.change_percent | number:'1.2-2' }}%)
            </span>
          </div>
        </div>

        <div class="picks-card-body">
          <!-- AI Score + Sentiment + Consensus Row -->
          <div class="ai-score-row">
            <div class="ai-score-badge" [ngClass]="getAiScoreClass(pick.ai_score)">
              <span class="ai-score-value">{{ pick.ai_score }}%</span>
              <span class="ai-score-label">AI Score</span>
            </div>
            <span class="sentiment-badge-pick" [ngClass]="getSentimentClass(pick.sentiment_label)">
              {{ pick.sentiment_label }}
            </span>
            <span class="consensus-badge"
              [class.consensus-strong-buy]="pick.consensus === 'Strong Buy'"
              [class.consensus-buy]="pick.consensus === 'Buy'"
              [class.consensus-hold]="pick.consensus === 'Hold'"
              [class.consensus-sell]="pick.consensus === 'Sell' || pick.consensus === 'Strong Sell'">
              {{ pick.consensus }}
            </span>
          </div>

          <!-- Reason Text -->
          <p class="picks-reason" *ngIf="pick.reason_text">{{ pick.reason_text }}</p>

          <!-- Analyst Bar -->
          <div class="analyst-bar">
            <div class="bar-strong-buy" [style.width.%]="(pick.strong_buy / getPickRecommendationTotal(pick)) * 100"></div>
            <div class="bar-buy" [style.width.%]="(pick.buy / getPickRecommendationTotal(pick)) * 100"></div>
            <div class="bar-hold" [style.width.%]="(pick.hold / getPickRecommendationTotal(pick)) * 100"></div>
            <div class="bar-sell" [style.width.%]="(pick.sell / getPickRecommendationTotal(pick)) * 100"></div>
            <div class="bar-strong-sell" [style.width.%]="(pick.strong_sell / getPickRecommendationTotal(pick)) * 100"></div>
          </div>

          <!-- Bottom Row: Sector + Category + Add -->
          <div class="picks-bottom-row">
            <span class="picks-sector" *ngIf="pick.sector">{{ pick.sector }}</span>
            <span class="category-badge" *ngIf="pick.category">{{ pick.category }}</span>
            <button *ngIf="!isInWatchlist(pick.symbol)" class="picks-add-btn" (click)="addPickToWatchlist(pick)">+ Watchlist</button>
            <span *ngIf="isInWatchlist(pick.symbol)" class="picks-in-list">In Watchlist</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Load More Button -->
    <button *ngIf="picksHasMore" class="load-more-btn" (click)="loadMorePicks()" [disabled]="loadingPicks">
      {{ loadingPicks ? 'Loading...' : 'Load More Picks' }}
    </button>

    <!-- Disclaimer Footer -->
    <div class="picks-disclaimer">
      AI-generated insights. Not financial advice. Please do your own research before investing.
    </div>
  </div>

  <!-- Monthly Earnings Panel -->
  <div
    id="panel-earnings"
    role="tabpanel"
    aria-labelledby="tab-earnings"
    [attr.tabindex]="0"
    *ngIf="activeTab === 'earnings'"
    class="section tab-panel"
  >
    <!-- Earnings Header with Month Nav -->
    <div class="earnings-header">
      <button class="month-nav-btn" [class.disabled]="!canGoPrevMonth()" [disabled]="!canGoPrevMonth()" (click)="changeEarningsMonth(-1)">&larr;</button>
      <h2 class="panel-title">{{ earningsMonthLabel }}</h2>
      <button class="month-nav-btn" [class.disabled]="!canGoNextMonth()" [disabled]="!canGoNextMonth()" (click)="changeEarningsMonth(1)">&rarr;</button>
    </div>

    <!-- Earnings Toolbar -->
    <div class="earnings-toolbar">
      <input
        type="text"
        class="earnings-search"
        placeholder="Search symbol..."
        [(ngModel)]="earningsSearchTerm"
        (input)="onEarningsSearchChange()"
      />
      <label class="my-stocks-toggle">
        <input type="checkbox" [(ngModel)]="earningsMyStocksOnly" (change)="onEarningsFilterChange()" />
        My Stocks Only
      </label>
    </div>

    <div *ngIf="loadingEarnings" class="loading" role="status" aria-live="polite">Loading earnings...</div>
    <div *ngIf="!loadingEarnings">
      <!-- Grouped by Date -->
      <div *ngFor="let group of getEarningsGroupedByDate()" class="earnings-date-group">
        <div class="date-header" [class.date-today]="isEarningsToday(group.date)">
          {{ group.date | date:'EEEE, MMM d' }}
          <span *ngIf="isEarningsToday(group.date)" class="today-badge">Today</span>
        </div>
        <table class="stock-table earnings-table earnings-desktop-table" aria-label="Earnings calendar">
          <thead>
            <tr>
              <th scope="col">Symbol</th>
              <th scope="col">Time</th>
              <th scope="col">EPS Est.</th>
              <th scope="col">Revenue Est.</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let earning of group.earnings" [class.watchlist-row]="isInWatchlist(earning.Symbol)">
              <td>
                <button class="earnings-symbol-btn" [class.in-watchlist]="isInWatchlist(earning.Symbol)" (click)="openEarningsAnalysis(earning.Symbol)" title="View earnings analysis">{{ earning.Symbol }}</button>
              </td>
              <td>
                <span [class.earnings-bmo]="earning.Time === 'bmo'" [class.earnings-amc]="earning.Time === 'amc'">
                  {{ getEarningsTime(earning.Time) }}
                </span>
              </td>
              <td>
                <span *ngIf="earning.EpsEstimate !== null"
                  [class.eps-negative]="earning.EpsEstimate < 0"
                  [class.eps-low]="earning.EpsEstimate >= 0 && earning.EpsEstimate <= 1"
                  [class.eps-normal]="earning.EpsEstimate > 1 && earning.EpsEstimate <= 5"
                  [class.eps-strong]="earning.EpsEstimate > 5"
                  [title]="getEpsTooltip(earning.EpsEstimate)">
                  {{ earning.EpsEstimate | number:'1.3-3' }}
                </span>
                <span *ngIf="earning.EpsEstimate === null">-</span>
              </td>
              <td>{{ formatRevenue(earning.RevenueEstimate) }}</td>
              <td>
                <button *ngIf="!isInWatchlist(earning.Symbol)" class="quick-add-btn" (click)="quickAddFromEarnings(earning.Symbol)" title="Add to watchlist">+</button>
                <span *ngIf="isInWatchlist(earning.Symbol)" class="in-list-icon" title="In your watchlist">&#10003;</span>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Mobile Earnings Cards -->
        <div class="mobile-earnings-cards">
          <div *ngFor="let earning of group.earnings" class="earnings-card" [class.watchlist-row]="isInWatchlist(earning.Symbol)" (click)="openEarningsAnalysis(earning.Symbol)">
            <div class="earnings-card-top">
              <div class="earnings-card-left">
                <button class="earnings-symbol-btn" [class.in-watchlist]="isInWatchlist(earning.Symbol)" (click)="$event.stopPropagation(); openEarningsAnalysis(earning.Symbol)">{{ earning.Symbol }}</button>
                <span [class.earnings-bmo]="earning.Time === 'bmo'" [class.earnings-amc]="earning.Time === 'amc'">
                  {{ getEarningsTime(earning.Time) }}
                </span>
              </div>
              <div class="earnings-card-right">
                <button *ngIf="!isInWatchlist(earning.Symbol)" class="quick-add-btn" (click)="$event.stopPropagation(); quickAddFromEarnings(earning.Symbol)" title="Add to watchlist">+</button>
                <span *ngIf="isInWatchlist(earning.Symbol)" class="in-list-icon" title="In your watchlist">&#10003;</span>
              </div>
            </div>
            <div class="earnings-card-details">
              <div class="earnings-card-detail">
                <span class="card-label">EPS Est.</span>
                <span class="card-val"
                  *ngIf="earning.EpsEstimate !== null"
                  [class.eps-negative]="earning.EpsEstimate < 0"
                  [class.eps-low]="earning.EpsEstimate >= 0 && earning.EpsEstimate <= 1"
                  [class.eps-normal]="earning.EpsEstimate > 1 && earning.EpsEstimate <= 5"
                  [class.eps-strong]="earning.EpsEstimate > 5">
                  {{ earning.EpsEstimate | number:'1.3-3' }}
                </span>
                <span class="card-val" *ngIf="earning.EpsEstimate === null">-</span>
              </div>
              <div class="earnings-card-detail">
                <span class="card-label">Revenue Est.</span>
                <span class="card-val">{{ formatRevenue(earning.RevenueEstimate) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="getEarningsGroupedByDate().length === 0" class="no-data">
        No earnings found for {{ earningsMonthLabel }}.
      </div>
    </div>

    <!-- Earnings Analysis Popup -->
    <div *ngIf="showAnalysisPopup" class="popup-overlay" (click)="closeAnalysisPopup()" role="dialog" aria-modal="true" aria-label="Earnings analysis">
      <div class="popup-content analysis-popup" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h3>Earnings Analysis</h3>
          <button class="close-btn" (click)="closeAnalysisPopup()" aria-label="Close dialog">&times;</button>
        </div>
        <div class="popup-body">
          <div *ngIf="loadingAnalysis" class="loading">Loading analysis...</div>
          <div *ngIf="!loadingAnalysis && analysisError" class="error-message">{{ analysisError }}</div>
          <div *ngIf="!loadingAnalysis && earningsAnalysis">
            <!-- Symbol & Name -->
            <div class="analysis-header">
              <div class="analysis-symbol">{{ earningsAnalysis.symbol }}</div>
              <div class="analysis-name">{{ earningsAnalysis.name }}</div>
              <span class="sector-badge" *ngIf="earningsAnalysis.sector">{{ earningsAnalysis.sector }}</span>
            </div>

            <!-- Outlook Badge -->
            <div class="outlook-section">
              <div class="outlook-badge"
                [class.outlook-positive]="earningsAnalysis.outlookLevel === 'positive'"
                [class.outlook-negative]="earningsAnalysis.outlookLevel === 'negative'"
                [class.outlook-neutral]="earningsAnalysis.outlookLevel === 'neutral'">
                {{ earningsAnalysis.outlook }}
              </div>
              <p class="outlook-reason" *ngIf="earningsAnalysis.outlookReason">{{ earningsAnalysis.outlookReason }}</p>
            </div>

            <!-- Key Metrics -->
            <div class="analysis-metrics">
              <div class="analysis-metric" *ngIf="earningsAnalysis.currentEstimate !== null">
                <span class="analysis-metric-label">EPS Estimate</span>
                <span class="analysis-metric-value">${{ earningsAnalysis.currentEstimate | number:'1.2-2' }}</span>
              </div>
              <div class="analysis-metric" *ngIf="earningsAnalysis.epsTTM !== null">
                <span class="analysis-metric-label">EPS TTM</span>
                <span class="analysis-metric-value">${{ earningsAnalysis.epsTTM | number:'1.2-2' }}</span>
              </div>
              <div class="analysis-metric" *ngIf="earningsAnalysis.peRatio !== null">
                <span class="analysis-metric-label">P/E Ratio</span>
                <span class="analysis-metric-value">{{ earningsAnalysis.peRatio | number:'1.2-2' }}</span>
              </div>
              <div class="analysis-metric" *ngIf="earningsAnalysis.beatRate !== null">
                <span class="analysis-metric-label">Beat Rate</span>
                <span class="analysis-metric-value">{{ earningsAnalysis.beatRate }}%</span>
              </div>
            </div>

            <!-- EPS History -->
            <div *ngIf="earningsAnalysis.epsHistory && earningsAnalysis.epsHistory.length > 0" class="eps-history-section">
              <h4>EPS History (Last {{ earningsAnalysis.epsHistory.length }} Quarters)</h4>
              <table class="eps-history-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Estimate</th>
                    <th>Actual</th>
                    <th>Surprise</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let eps of earningsAnalysis.epsHistory">
                    <td>{{ eps.date | date:'MMM yyyy' }}</td>
                    <td>{{ eps.estimate | number:'1.2-2' }}</td>
                    <td [class.positive]="eps.actual >= eps.estimate" [class.negative]="eps.actual < eps.estimate">{{ eps.actual | number:'1.2-2' }}</td>
                    <td>
                      <span [class.surprise-positive]="eps.surprise >= 0" [class.surprise-negative]="eps.surprise < 0">
                        {{ eps.surprise >= 0 ? '+' : '' }}{{ eps.surprise | number:'1.1-1' }}%
                      </span>
                    </td>
                    <td>
                      <span class="beat-badge" *ngIf="eps.beat">BEAT</span>
                      <span class="miss-badge" *ngIf="!eps.beat">MISS</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Analyst Ratings -->
            <div *ngIf="earningsAnalysis.recommendation" class="analyst-section">
              <div class="analyst-title">Analyst Ratings</div>
              <div class="analyst-bar">
                <div class="bar-strong-buy" [style.width.%]="(earningsAnalysis.recommendation.strongBuy / getAnalysisRecommendationTotal()) * 100"></div>
                <div class="bar-buy" [style.width.%]="(earningsAnalysis.recommendation.buy / getAnalysisRecommendationTotal()) * 100"></div>
                <div class="bar-hold" [style.width.%]="(earningsAnalysis.recommendation.hold / getAnalysisRecommendationTotal()) * 100"></div>
                <div class="bar-sell" [style.width.%]="(earningsAnalysis.recommendation.sell / getAnalysisRecommendationTotal()) * 100"></div>
                <div class="bar-strong-sell" [style.width.%]="(earningsAnalysis.recommendation.strongSell / getAnalysisRecommendationTotal()) * 100"></div>
              </div>
              <div class="analyst-labels">
                <span class="label-strong-buy">Strong Buy {{ earningsAnalysis.recommendation.strongBuy }}</span>
                <span class="label-buy">Buy {{ earningsAnalysis.recommendation.buy }}</span>
                <span class="label-hold">Hold {{ earningsAnalysis.recommendation.hold }}</span>
                <span class="label-sell">Sell {{ earningsAnalysis.recommendation.sell }}</span>
                <span class="label-strong-sell">Strong Sell {{ earningsAnalysis.recommendation.strongSell }}</span>
              </div>
            </div>

            <div *ngIf="!earningsAnalysis.recommendation && earningsAnalysis.epsHistory.length === 0 && earningsAnalysis.epsTTM === null && earningsAnalysis.peRatio === null" class="no-data">
              No analysis data available for this stock.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- News Panel -->
  <div
    id="panel-news"
    role="tabpanel"
    aria-labelledby="tab-news"
    [attr.tabindex]="0"
    *ngIf="activeTab === 'news'"
    class="section tab-panel"
  >
    <!-- News Toolbar -->
    <div class="news-toolbar">
      <div class="news-filters">
        <button class="filter-btn" [class.active]="newsFilter === 'all'" (click)="setNewsFilter('all')">All</button>
        <button class="filter-btn filter-positive" [class.active]="newsFilter === 'positive'" (click)="setNewsFilter('positive')">Positive</button>
        <button class="filter-btn filter-negative" [class.active]="newsFilter === 'negative'" (click)="setNewsFilter('negative')">Negative</button>
        <button class="filter-btn filter-neutral" [class.active]="newsFilter === 'neutral'" (click)="setNewsFilter('neutral')">Neutral</button>
      </div>
      <button class="refresh-btn" (click)="refreshNews()" [disabled]="loadingNews" title="Refresh news">
        &#x21bb;
      </button>
    </div>

    <div *ngIf="loadingNews" class="loading" role="status" aria-live="polite">Loading news...</div>
    <div *ngIf="!loadingNews" class="news-list">
      <article *ngFor="let item of getFilteredNews()" class="news-item">
        <div class="news-row">
          <img *ngIf="item.image" [src]="item.image" alt="" class="news-thumbnail" loading="lazy" (error)="item.image = ''">
          <div class="news-body">
            <div class="news-header-row">
              <a [href]="item.url" target="_blank" rel="noopener noreferrer" class="news-title-link">{{ item.title }}</a>
              <span
                class="sentiment-badge"
                [class.sentiment-positive]="item.sentiment === 'positive'"
                [class.sentiment-negative]="item.sentiment === 'negative'"
                [class.sentiment-neutral]="item.sentiment === 'neutral'"
              >{{ item.sentimentLabel }}</span>
            </div>
            <div class="news-tags">
              <span *ngFor="let sym of isWatchlistRelated(item.title)" class="watchlist-tag">{{ sym }}</span>
            </div>
            <div class="news-meta">
              <span class="news-source">{{ item.source }}</span>
              <time class="news-time">{{ item.time }}</time>
              <button *ngIf="item.summary" class="expand-btn" (click)="toggleNewsSummary(item)">
                {{ item.expanded ? 'Hide' : 'Read more' }}
              </button>
            </div>
            <p *ngIf="item.expanded && item.summary" class="news-summary">{{ item.summary }}</p>
          </div>
        </div>
      </article>
      <div *ngIf="getFilteredNews().length === 0" class="no-data">
        No news available for this filter.
      </div>
      <button *ngIf="hasMoreNews()" class="load-more-btn" (click)="loadMoreNews()">Load More</button>
    </div>
  </div>

  <!-- Mobile Bottom Tab Bar -->
  <div class="mobile-bottom-tabs">
    <button *ngFor="let tab of tabs" class="bottom-tab" [class.bottom-tab-active]="activeTab === tab.id" (click)="selectTab(tab.id)">
      <svg *ngIf="tab.id === 'watchlist'" class="bottom-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M7 16l4-8 4 4 4-6"/></svg>
      <svg *ngIf="tab.id === 'options'" class="bottom-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
      <svg *ngIf="tab.id === 'recommendations'" class="bottom-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M9 15l2 2 4-4"/></svg>
      <svg *ngIf="tab.id === 'earnings'" class="bottom-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="18" rx="2"/><path d="M2 9h20"/><path d="M9 21V9"/></svg>
      <svg *ngIf="tab.id === 'news'" class="bottom-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/><path d="M2 10h20"/><path d="M10 4v16"/></svg>
      <span class="bottom-tab-label">{{ tab.id === 'watchlist' ? 'Stocks' : tab.id === 'options' ? 'Options' : tab.id === 'recommendations' ? 'AI Picks' : tab.id === 'earnings' ? 'Earnings' : 'News' }}</span>
    </button>
  </div>

</div>
